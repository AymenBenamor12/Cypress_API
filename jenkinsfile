pipeline {
    agent any  // Utiliser un agent disponible pour exécuter le pipeline
    tools {
        nodejs 'Cypress config' // Assurez-vous que 'Cypress config' est bien configuré dans Jenkins
    }
    stages {
        stage('Building : Install Dependencies') {
            steps {
                bat '''
                cd /d "D:/QA_et_Automatisation/Testing_Auto/Cypress/CypressAPI" && npm install && npm install mochawesome mochawesome-merge mochawesome-report-generator --save-dev
                '''
            }
        }

        stage('Testing : Run Cypress Tests') {
            steps {
                bat '''
                cd /d "D:/QA_et_Automatisation/Testing_Auto/Cypress/CypressAPI" && npx cypress run
                '''
            }
        }

        stage('Deploying') {
            steps {
                echo "Deploy the application"
            }
        }

        stage('Generate Report') {
            steps {
                bat '''
                cd /d "D:/QA_et_Automatisation/Testing_Auto/Cypress/CypressAPI" && npx cypress run --reporter mochawesome
                '''
            }
        }
    }
    post {
        always {
            // Nettoyage après l'exécution du pipeline
            cleanWs()  // Supprime les fichiers temporaires pour nettoyer l'espace de travail
        }
    }
}
